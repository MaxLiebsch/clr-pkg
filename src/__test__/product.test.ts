import { describe, expect, test } from '@jest/globals';
import { Db, ObjectId } from 'mongodb';
import { ProductFacotry } from '../util/ProductFactory';
import { DbProductRecord } from '../types/DbProductRecord';

describe('Product test', () => {
  test('ProductFactory.createFromApi', () => {
    const product = ProductFacotry.createFromApi({
      _id: new ObjectId('668b59fcd63905fe521629dc'),
      lnk: 'https://www.idealo.de/preisvergleich/OffersOfProduct/5492373_-d7500-body-nikon.html',
      createdAt: '2024-07-08T03:16:12.397Z',
      ctgry: ['Elektroartikel', 'Spiegelreflexkameras'],
      eanList: ['0018208953479'],
      img: 'https://cdn.idealo.com/folder/Product/5492/3/5492373/s1_produktbild_mittelgross/nikon-d7500-body.jpg',
      mnfctr: 'Nikon',
      nm: 'D7500 Body',
      prc: 735,
      updatedAt: '2024-11-06T04:50:38.975Z',
      qty: 1,
      s_hash: '41bb9f0caff8b5d171a0118011c92895',
      uprc: 735,
      eanUpdatedAt: '2024-08-19T05:14:53.357Z',
      ean_prop: 'found',
      sku: '0018208953479',
      cur: 'EUR',
      hasMnfctr: false,
      a: 'sofort lieferbar',
      availUpdatedAt: '2024-10-29T00:11:27.148Z',
      sdmn: 'idealo.de',
      catUpdatedAt: '2024-10-29T00:33:04.562Z',
      cat_prop: 'ean_missing',
      shop: 'idealo.de',
      qty_v: 'v04',
      nm_vrfd: {
        qty_prop: 'complete',
        qty_score: 0.9,
      },
      qty_updatedAt: '2024-10-29T00:33:01.306Z',
      nm_v: 'v01',
      nm_updatedAt: '2024-10-29T00:41:01.035Z',
      e_img: 'https://i.ebayimg.com/images/g/j9UAAOSwWLhnCOw3/s-l500.webp',
      e_nm: 'Nikon D7500 Gehäuse , Ausstellungsstück, nur 500 Auslösungen #X38195_33640**',
      e_orgn: 'e',
      e_pRange: {
        min: 849.99,
        max: 949.9,
        median: 899.9449999999999,
      },
      e_pblsh: false,
      e_prc: 849.99,
      e_qty: 1,
      e_totalOfferCount: 2,
      e_uprc: 849.99,
      eby_prop: 'complete',
      esin: '335613567460',
      qEbyUpdatedAt: '2024-11-03T02:56:45.310Z',
      ahstprcs: [
        [1722033360, 91900],
        [1724231880, 118560],
        [1724297280, 118560],
        [1724386080, 118560],
        [1726612320, 92900],
      ],
      anhstprcs: [
        [1722938400, 89408],
        [1723644480, 86363],
        [1723769040, 86187],
        [1723889760, 91900],
        [1724207280, 92550],
        [1724420880, 84151],
        [1724527200, 84441],
        [1724804400, 84459],
        [1724903520, 84461],
        [1725367920, 91900],
        [1725984840, 94560],
        [1726998960, 92867],
        [1727606880, 84249],
        [1727750640, 85569],
        [1727824080, 84195],
        [1727981160, 84090],
        [1728028320, 84027],
        [1728102000, 83969],
        [1728232320, 83965],
        [1728448560, 83799],
        [1728541560, 83800],
        [1728767280, 83800],
        [1728847920, 83800],
        [1728958080, 85579],
        [1729145520, 82621],
        [1729270320, 81694],
        [1729403280, 81718],
        [1729494120, 81708],
        [1729567200, 80452],
        [1729635840, 80438],
        [1729779840, 80416],
        [1729811400, 80412],
        [1729899840, 80323],
        [1730016480, 79975],
        [1730105040, 79622],
        [1730178240, 79275],
        [1730252040, 79248],
        [1730335200, 79209],
        [1730419200, 78999],
        [1730502840, 77880],
        [1730639280, 77859],
        [1730831400, 87293],
      ],
      asin: 'B071QXWN9R',
      auhstprcs: [
        [1722927360, 82280],
        [1723252800, 82279],
        [1723351080, 82279],
        [1723476360, 81853],
        [1723555200, 81854],
        [1723644480, 81854],
        [1723682400, 81855],
        [1723769040, 81855],
        [1723913760, 82799],
        [1723953960, 82800],
        [1724042280, 82800],
        [1724133480, 82799],
        [1724247360, 82800],
        [1724334360, 65005],
        [1724370000, 65006],
        [1724459520, 65006],
        [1724545680, 65006],
        [1724631360, 65006],
        [1724719320, 65006],
        [1724804400, 65006],
        [1724950200, 82797],
        [1725915360, 81983],
        [1725993000, 81984],
        [1726060440, 63765],
        [1726100640, 63766],
        [1726253640, 63760],
        [1726343280, 82793],
        [1726417200, 82800],
        [1727113680, 81288],
        [1727787600, 82898],
        [1727874240, 82898],
        [1727914080, 71807],
        [1728001440, 71807],
        [1728087120, 71807],
        [1728173400, 71807],
        [1728262200, 71807],
        [1728399240, 71805],
        [1728440160, 82899],
        [1728517800, 82899],
        [1728601200, 82893],
        [1728751320, 59510],
        [1728830640, 59510],
        [1728930480, 59507],
        [1729016160, 59507],
        [1729090080, 59510],
        [1729169520, 59511],
        [1729208640, 59512],
        [1729350960, 59510],
        [1729447560, 59507],
        [1729546080, 59506],
        [1729623240, 59507],
        [1729720320, 59506],
        [1729799520, 59506],
        [1729909920, 82900],
        [1730144880, 82894],
        [1730216760, 82897],
        [1730320080, 82894],
        [1730402160, 82894],
        [1730488080, 82894],
        [1730565120, 82897],
        [1730644680, 82898],
        [1730728800, 82898],
        [1730784240, 82899],
        [1730860560, 82899],
      ],
      avg30_ansprcs: 81916,
      avg30_ausprcs: 71741,
      avg30_salesRank: 3841,
      avg90_ahsprcs: 92614,
      avg90_ansprcs: 87046,
      avg90_ausprcs: 76097,
      avg90_salesRank: 4413,
      brand: 'Nikon',
      categories: [760674, 90202100031],
      categoryTree: [
        {
          catId: 562066,
          name: 'Elektronik & Foto',
        },
        {
          catId: 571860,
          name: 'Kamera & Foto',
        },
        {
          catId: 571862,
          name: 'Digitalkameras',
        },
        {
          catId: 760674,
          name: 'Digitale Spiegelreflexkameras',
        },
      ],
      costs: {
        tpt: 5.42,
        varc: 0,
        azn: 57.34,
        strg_1_hy: 0.22,
        strg_2_hy: 0.34,
        estmtd: false,
        dfltTpt: false,
        noStrgFee: false,
        prvsn: 7,
        ktpt: 5.43,
      },
      curr_ansprcs: 87805,
      curr_ausprcs: 82899,
      curr_salesRank: 2456,
      iwhd: {
        height: 104,
        length: 135,
        width: 72,
        weight: 720,
      },
      k_eanList: ['0018208953479'],
      keepaEanUpdatedAt: '2024-11-06T04:09:48.712Z',
      monthlySold: 121,
      numberOfItems: 1,
      pwhd: {
        height: 134,
        length: 292,
        width: 207,
        weight: 1650,
      },
      salesRanks: {
        '571860': [
          [1723089120, 7727],
          [1723189200, 4437],
          [1723278720, 6954],
          [1723359840, 2254],
          [1723449360, 1963],
          [1723528080, 2004],
          [1723623600, 2003],
          [1723704960, 3257],
          [1723799640, 6819],
          [1723884720, 3604],
          [1723966560, 3448],
          [1724068680, 7579],
          [1724141640, 3553],
          [1724270640, 1708],
          [1724353080, 3213],
          [1724433480, 2779],
          [1724586720, 6583],
          [1724745840, 2679],
          [1724855280, 1811],
          [1725074400, 5156],
          [1725200520, 3068],
          [1725373560, 1737],
          [1725462480, 1391],
          [1725655920, 5467],
          [1725810840, 5170],
          [1725889440, 7565],
          [1725976680, 9227],
          [1726060440, 5002],
          [1726186080, 4073],
          [1726313520, 7466],
          [1726401600, 2979],
          [1726487520, 2890],
          [1726562760, 4905],
          [1726688880, 4257],
          [1726774320, 6526],
          [1726910640, 2369],
          [1727084640, 2344],
          [1727176560, 6213],
          [1727260080, 8249],
          [1727337840, 5603],
          [1727438160, 5507],
          [1727523960, 7743],
          [1727626320, 8548],
          [1727783760, 6602],
          [1727877120, 8593],
          [1727953200, 4187],
          [1728061680, 5541],
          [1728176160, 7868],
          [1728279840, 9663],
          [1728409440, 1329],
          [1728493920, 2374],
          [1728659280, 2252],
          [1728751320, 2364],
          [1728837120, 3928],
          [1728979320, 3098],
          [1729085520, 3684],
          [1729169520, 2494],
          [1729250160, 3038],
          [1729706640, 2442],
          [1729834200, 4667],
          [1729923360, 1223],
          [1730004720, 3963],
          [1730163360, 5482],
          [1730251320, 7342],
          [1730384880, 8488],
          [1730450160, 9396],
          [1730565120, 3303],
          [1730656800, 2164],
          [1730796960, 1747],
        ],
        '760674': [
          [1723089120, 22],
          [1723271520, 22],
          [1723480800, 6],
          [1723661280, 14],
          [1723835760, 19],
          [1723990560, 3],
          [1724100120, 6],
          [1724353080, 9],
          [1724546520, 23],
          [1724751120, 3],
          [1725228000, 7],
          [1725589800, 10],
          [1725879840, 29],
          [1726021440, 38],
          [1726176000, 11],
          [1726453560, 6],
          [1726731600, 17],
          [1726969680, 7],
          [1727189280, 24],
          [1727393040, 14],
          [1727618880, 30],
          [1727881920, 29],
          [1728106560, 24],
          [1728307560, 26],
          [1728728400, 5],
          [1728950160, 19],
          [1729129200, 6],
          [1729337280, 7],
          [1729523880, 21],
          [1729640880, 7],
          [1729753920, 3],
          [1729876680, 15],
          [1730064240, 13],
          [1730230080, 21],
          [1730365920, 25],
          [1730533920, 13],
          [1730639280, 6],
        ],
      },
      totalOfferCount: 6,
      a_img: 'https://m.media-amazon.com/images/I/51RCGYaS9dL._SL120_.jpg',
      a_nm: 'Nikon D7500 Digital SLR im DX Format (20,9 MP, EXPEED 5-Prozessor, AF-System mit 51 Messfeldern, ISO 100-51.200, 4K UHD Video incl. Zeitraffer Video)',
      a_orgn: 'a',
      a_pblsh: true,
      a_prc: 819.16,
      a_qty: 1,
      a_rating: 4,
      a_reviewcnt: 811,
      a_uprc: 819.16,
      a_vrfd: {
        vrfd: false,
        vrfn_pending: true,
        flags: [],
        flag_cnt: 0,
      },
      aznUpdatedAt: '2024-11-06T04:50:38.971Z',
      bsr: [
        {
          createdAt: '2024-11-06T04:50:38.933Z',
          category: 'Kamera & Foto',
          number: 5751,
        },
      ],
      buyBoxIsAmazon: true,
      a_mrgn: -46905.55,
      a_mrgn_pct: -5726.05,
      a_p_mrgn: -46905.8,
      a_p_mrgn_pct: -5726.09,
      a_p_w_mrgn: -46905.92,
      a_p_w_mrgn_pct: -5726.1,
      a_useCurrPrice: false,
      a_w_mrgn: -46905.67,
      a_w_mrgn_pct: -5726.07,
      gl: 'gl_camera',
      cmpPrcThrshld: 73900,
      drops30: 36,
      drops90: 118,
      keepaUpdatedAt: '2024-11-04T17:14:30.305Z',
      infoUpdatedAt: '2024-11-06T04:50:38.971Z',
      info_prop: 'complete',
      tax: 19,
    } as unknown as DbProductRecord);


    console.log(product.aznInitialized())
    console.log(JSON.stringify(product.getCore().processProps, null,2))
  });
});
